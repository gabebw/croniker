#!/bin/sh

set -e

stack install yesod-bin cabal-install --install-ghc
stack build
if ! psql -l | cut -d'|' -f1 | grep -qF croniker_development; then
  createdb croniker_development
fi

if ! command -v docker-compose > /dev/null; then
    echo "Install docker-compose"
    exit 1
fi

if ! heroku plugins | grep -Fq heroku-docker; then
    heroku plugins:install heroku-docker
fi

heroku git:remote --remote staging --app croniker-staging
heroku git:remote --remote production --app croniker-production

echo "Run the server: stack exec -- yesod devel"
